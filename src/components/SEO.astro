---
interface Props {
  title?: string;
  description?: string;
  image?: string;
  url?: string;
  type?: string;
  datePublished?: string;
}

import social from '../data/social.json';

const siteTitle = 'Fernando Penna | Senior Software Engineer & Tech Manager';
const siteDescription = 'Results-driven Tech Manager and Senior Software Engineer with extensive expertise in Node.js, AWS, DevOps, and Full-Stack Development. Based in São Paulo, Brazil.';
const siteUrl = import.meta.env.SITE || 'https://zamper.dev.br';
const basePath = import.meta.env.BASE_URL;

const {
  title = siteTitle,
  description = siteDescription,
  image = `${siteUrl}${basePath}og-image.png`,
  url = `${siteUrl}${basePath}`,
  type = 'website',
  datePublished,
} = Astro.props;

const canonicalUrl = new URL(url, siteUrl).href;

const sameAs = social
  .map((s: { url: string }) => s.url)
  .filter((u: string) => u.startsWith('http'));

const personJsonLd = JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'Person',
  name: 'Fernando Penna',
  jobTitle: 'Senior Software Engineer / Tech Manager',
  url: canonicalUrl,
  sameAs,
  knowsAbout: ['Node.js', 'AWS', 'Kubernetes', 'DevOps', 'Full-Stack Development'],
  address: {
    '@type': 'PostalAddress',
    addressLocality: 'São Paulo',
    addressCountry: 'BR',
  },
  image: image,
  description: siteDescription,
});

const articleJsonLd = type === 'article' ? JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'BlogPosting',
  headline: title,
  description: description,
  image: image,
  url: canonicalUrl,
  author: { '@type': 'Person', name: 'Fernando Penna' },
  publisher: { '@type': 'Person', name: 'Fernando Penna' },
  ...(datePublished ? { datePublished, dateModified: datePublished } : {}),
  mainEntityOfPage: { '@type': 'WebPage', '@id': canonicalUrl },
}) : null;

const breadcrumbJsonLd = type === 'article' ? JSON.stringify({
  '@context': 'https://schema.org',
  '@type': 'BreadcrumbList',
  itemListElement: [
    { '@type': 'ListItem', position: 1, name: 'Home', item: `${siteUrl}${basePath}` },
    { '@type': 'ListItem', position: 2, name: 'Blog', item: `${siteUrl}${basePath}blog/` },
    { '@type': 'ListItem', position: 3, name: title },
  ],
}) : null;
---

<title>{title}</title>
<meta name="title" content={title} />
<meta name="description" content={description} />
<link rel="canonical" href={canonicalUrl} />

<meta property="og:locale" content="en_US" />
<meta property="og:site_name" content="Fernando Penna" />
<meta property="og:type" content={type} />
<meta property="og:url" content={canonicalUrl} />
<meta property="og:title" content={title} />
<meta property="og:description" content={description} />
<meta property="og:image" content={image} />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:url" content={canonicalUrl} />
<meta name="twitter:title" content={title} />
<meta name="twitter:description" content={description} />
<meta name="twitter:image" content={image} />

<script type="application/ld+json" set:html={personJsonLd}></script>
{articleJsonLd && <script type="application/ld+json" set:html={articleJsonLd}></script>}
{breadcrumbJsonLd && <script type="application/ld+json" set:html={breadcrumbJsonLd}></script>}
