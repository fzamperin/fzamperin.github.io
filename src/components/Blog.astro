---
import { getCollection } from 'astro:content';

const posts = (await getCollection('blog'))
  .filter((post) => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);

const basePath = import.meta.env.BASE_URL;
---

<section id="blog" class="section">
  <div class="container">
    <h2 class="section__title fade-up">
      <span class="accent-text">#</span> Blog
    </h2>

    {posts.length > 0 ? (
      <div class="blog-grid">
        {posts.map((post, i) => (
          <a href={`${basePath}blog/${post.id}/`} class="blog-card fade-up" style={`animation-delay: ${i * 0.1}s`}>
            <time class="blog-card__date">{post.data.date.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}</time>
            <h3 class="blog-card__title">{post.data.title}</h3>
            <p class="blog-card__desc">{post.data.description}</p>
            {post.data.tags && (
              <div class="blog-card__tags">
                {post.data.tags.map((tag: string) => (
                  <span class="tag-sm">{tag}</span>
                ))}
              </div>
            )}
          </a>
        ))}
      </div>
    ) : (
      <p class="blog-empty fade-up">No posts yet. Check back soon!</p>
    )}

    {posts.length > 0 && (
      <div class="blog-more fade-up">
        <a href={`${basePath}blog/`} class="blog-more__link">View all posts &rarr;</a>
      </div>
    )}
  </div>
</section>

<style>
  .section__title {
    font-family: var(--font-mono);
    font-size: clamp(1.5rem, 4vw, 2rem);
    color: var(--text);
    margin-bottom: 3rem;
  }

  .blog-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 1.5rem;
  }

  .blog-card {
    background: var(--surface);
    border: 1px solid var(--border);
    padding: 1.5rem 2rem;
    text-decoration: none;
    transition: border-color 0.2s, transform 0.2s, box-shadow 0.2s;
    display: block;
  }

  .blog-card:hover {
    border-color: var(--accent);
    transform: translateY(-2px);
    box-shadow: var(--accent-glow);
  }

  .blog-card__date {
    font-family: var(--font-mono);
    font-size: 0.8rem;
    color: var(--accent);
    display: block;
    margin-bottom: 0.5rem;
  }

  .blog-card__title {
    font-family: var(--font-mono);
    font-size: 1.05rem;
    color: var(--text);
    margin-bottom: 0.5rem;
  }

  .blog-card__desc {
    color: var(--text-dim);
    font-size: 0.9rem;
    line-height: 1.6;
    margin-bottom: 1rem;
  }

  .blog-card__tags {
    display: flex;
    flex-wrap: wrap;
    gap: 0.4rem;
  }

  .tag-sm {
    font-family: var(--font-mono);
    font-size: 0.7rem;
    color: var(--text-dim);
    background: var(--surface-light);
    padding: 0.2rem 0.5rem;
    border: 1px solid var(--border);
  }

  .blog-empty {
    color: var(--text-dim);
    font-family: var(--font-mono);
  }

  .blog-more {
    margin-top: 2rem;
    text-align: center;
  }

  .blog-more__link {
    font-family: var(--font-mono);
    font-size: 0.9rem;
    color: var(--accent);
    text-decoration: none;
    transition: opacity 0.2s;
  }

  .blog-more__link:hover {
    opacity: 0.7;
  }
</style>
